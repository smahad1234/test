name: Dead Code Cleaner - Lightweight

on:
  pull_request:
    types: [opened, synchronize]
  workflow_dispatch:

jobs:
  deadcode-scan:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout PR branch
        uses: actions/checkout@v4

      - name: Scan for Dead Java Files
        id: scan
        run: |
          echo "Scanning for unused Java classes..."
          mkdir -p deadcode
          for file in $(find src/main/java -name "*.java"); do
            class=$(basename "$file" .java)
            usage=$(grep -r "$class" src/main/java | grep -v "$file" || true)
            if [ -z "$usage" ]; then
              echo "Unused class detected: $class"
              echo "$file" >> deadcode/list.txt
            fi
          done
          echo "files=$(cat deadcode/list.txt || true)" >> $GITHUB_OUTPUT

      - name: Show Dead Code Summary
        run: |
          if [ -f deadcode/list.txt ]; then
            echo "Dead code files found:"
            cat deadcode/list.txt
          else
            echo "No dead code detected."
          fi

      - name: (Optional) Commit Cleanup
        if: steps.scan.outputs.files != ''
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "‚ö†Ô∏è Skipping auto-delete by default. Uncomment to remove files:"
          # git rm $(cat deadcode/list.txt)
          # git commit -m "ü§ñ Remove dead code"
          # git push origin HEAD:${{ github.head_ref }}
